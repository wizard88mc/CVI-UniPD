<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />

<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
Remove this if you use the .htaccess -->

<title>prova</title>
<meta name="description" content="" />
<meta name="author" content="Matteo" />

<link href="../style/custom-theme/jquery-ui-1.8.21.custom.css" rel="stylesheet" />
<link href="style/catchMe.css" rel="stylesheet" />
<script src="../js/jquery-1.7.2.min.js"></script>
<script src="../js/jquery-ui-1.8.21.custom.min.js"></script>
<style>
	div.demo { padding: 10px !important; }
</style>

<!--<script src="../js/jgestures.min.js"></script>
<script src="../js/Utilities.js"></script>
<script src="../js/WebSocketManager.js"></script>
<script src="../js/TouchTracker.js"></script>-->

<script type="text/javascript">
var cvd = function () {
    var output = '';  
    var that={};
    var oldFuncs;;
    
    var caller = function (prop) {
        return function () {
            var args = '',
                str = '';
            for (var i = 0; i < arguments.length; i++) {
                args += arguments[i];
                if (i !== arguments.length - 1) { args += ','; }
            }           
            str = 'ctx.' + prop + '(' + args + ');';
            output += str + '\n';           
        };
    };
    
    that.overrideFuncs = function () {
        oldFuncs = {};
        for (var prop in CanvasRenderingContext2D.prototype) {         
            if (CanvasRenderingContext2D.prototype.hasOwnProperty(prop)) {
                try {                   
                    var oldFunc = CanvasRenderingContext2D.prototype[prop];
                     if ((typeof oldFunc == 'function') &&  (prop !== 'createLinearGradient') &&  (prop !== 'createRadialGradient')) {                    
                        oldFuncs[prop] = oldFunc;
                        CanvasRenderingContext2D.prototype[prop] = caller(prop);
                    }
                }
                catch (e) {}
            }
        }
    }    
    
    that.restoreFuncs = function() {
        for (var key in oldFuncs) {
            if(oldFuncs.hasOwnProperty(key) ){
                CanvasRenderingContext2D.prototype[key] = oldFuncs[key];
            }
        }
    }
    
    that.logCommand = function(command) {
        output += command  + ';\n';  
    }
    that.getOutput = function() {return output;}
    
    that.clearOutput = function() { output = '';};
    return that;
}();      
</script>
<script src="http://canvg.googlecode.com/svn/trunk/rgbcolor.js"></script> 
<script src="http://canvg.googlecode.com/svn/trunk/canvg.js"></script> 

<script>
	$(document).ready(function(){

      var canvas = $('#temp')[0],
				ctx = canvas.getContext('2d'),  
				canvas2 = $('#temp2')[0],
				ctx2 = canvas2.getContext('2d');  
				 
			$('#clear-button').bind('click',function() {   
					cvd.clearOutput();
					$('#svg-input').val('');
					$('#js-output').val('');
					ctx2.clearRect(0,0,canvas2.width,canvas2.height); 
			});
			
			$('#convert-button').bind('click',function() {                 
					var	str = $.trim( $('#svg-input').val())
					if(!str.length) return;
					$('#js-output').val('');
					cvd.overrideFuncs();
					cvd.clearOutput();
					var	str = $.trim( $('#svg-input').val());
					canvg('temp',  str);
			 
					$('#js-output').val( 'var draw = function(ctx) {\n' + cvd.getOutput() + '};' );
					cvd.restoreFuncs();
					canvas2.width = canvas.width;
					 canvas2.height = canvas.height;
					var fn = new Function('ctx',cvd.getOutput());
					fn(ctx2);                                  
			});			 
});
</script>


</head>
<body class="ui-widget-content" style="border:0;">

<textarea id="svg-input" style="width:100%;height:192px"></textarea>
      
          <p><input id="convert-button" type="button" value="Convert" />
          the SVG into a JavaScript HTML5 Canvas function. 
      <input id="clear-button" type="button" value="Clear All" /></p>
      <p>The function should be passed a Canvas 2d drawing context.</p>
      <textarea id="js-output" style="width:100%;height:192px"></textarea>
      <p>Output from the JavaScript function is shown below:</p>
      
        <div style="border:1px solid #999999;overflow:scroll;width:100%;height:256px;">
        <canvas id="temp2"></canvas>
       </div>
        <canvas style="display:none;"  width = '1024' height = '512' id="temp"  ></canvas>
</div>
</body>
</html>
